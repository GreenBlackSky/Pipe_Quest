<Level>
    <Listeners>
        <Listener initial="true" id="0">
            <Triggers>
                <Trigger type="dialogue_reply" id="0"/>
            </Triggers>
            <Conditions>
                <Complex_condition type="not">
                    <Condition id="quest_completed"/>
                </Complex_condition>
            </Conditions>
            <Callbacks>
                <Callback type="start_quest">
                    <arg name="quest_id" type="int" val="0"/> 
                </Callback>
                <Callback type="start_listener">
                    <arg name="listener_id" type="int" val="1"/> 
                </Callback>
                <Callback type="start_listener">
                    <arg name="listener_id" type="int" val="2"/> 
                </Callback>
                <Callback type="start_listener">
                    <arg name="listener_id" type="int" val="3"/> 
                </Callback>
                <Callback type="stop_listener">
                    <arg name="listener_id" type="int" val="0"/> 
                </Callback>
            </Callbacks>
        </Listener>

        <Listener id="1">
            <Triggers>
                <Trigger type="collect_item" id="mushroom"/>
            </Triggers>
            <Conditions>
                <Complex_condition type="less_then">
                    <Provider type="items_in_inventory">
                        <arg name="item_id" type="string" value="mushroom"/>
                    </Provider>
                    <arg name="value" type="int" value="5"/>
                </Complex_condition type="less_then">
            </Conditions>
            <Callbacks>
                <Callback type="set_quest_node">
                    <arg name="quest_id" type="int" val="0"/>
                    <arg name="next_node_id" type="int" val="1"/>
                </Callback>
            </Callbacks>
        </Listener>

        <Listener id="2">
            <Triggers>
                <Trigger type="lost_item" id="mushroom"/>
            </Triggers>
            <Conditions>
                <Complex_condition type="more_then">
                    <Provider type="items_in_inventory">
                        <arg name="item_id" type="string" value="mushroom"/>
                    </Provider>
                    <arg name="value" type="int" value="0"/>
                </Complex_condition>
            </Conditions>
            <Callbacks>
                <Callback type="set_quest_node">
                    <arg name="quest_id" type="int" val="0"/>
                    <arg name="next_node_id" type="int" val="2"/>
                </Callback>
                <Callback type="start_listener">
                    <arg name="listener_id" type="int" val="1"/> 
                </Callback>
            </Callbacks>
        </Listener>

        <Listener id="3">
            <Triggers>
                <Trigger type="collect_item" id="mushroom"/>
            </Triggers>
            <Conditions>
                <Complex_condition type="is_equal_to">
                    <Provider type="items_in_inventory">
                        <arg name="item_id" type="string" value="mushroom"/>
                    </Provider>
                    <arg name="value" type="int" value="5"/>
                </Complex_condition>
            </Conditions>
            <Callbacks>
                <Callback type="set_quest_node">
                    <arg name="quest_id" type="int" val="0"/>
                    <arg name="next_node_id" type="int" val="3"/>
                </Callback>
                <Callback type="stop_listener">
                    <arg name="listener_id" type="int" val="1"/> 
                </Callback>
            </Callbacks>
        </Listener>

        <Listener id="4">
            <Triggers>
                <Trigger type="dialogue_reply" id="1"/>
            </Triggers>
            <Conditions>
                <Complex_condition type="is_equal_to">
                    <Provider type="items_in_inventory">
                        <arg name="item_id" type="string" value="mushroom"/>
                    </Provider>
                    <arg name="value" type="int" value="5"/>
                </Complex_condition>
            </Conditions>
            <Callbacks>
                <Callback type="set_quest_node">
                    <arg name="quest_id" type="int" val="0"/>
                    <arg name="next_node_id" type="int" val="4"/>
                </Callback>
                <Callback type="stop_listener">
                    <arg name="listener_id" type="int" val="2"/> 
                </Callback>
                <Callback type="stop_listener">
                    <arg name="listener_id" type="int" val="3"/> 
                </Callback>
                <Callback type="stop_listener">
                    <arg name="listener_id" type="int" val="4"/> 
                </Callback>
            </Callbacks>
        </Listener>
    </Listeners>
</Level>