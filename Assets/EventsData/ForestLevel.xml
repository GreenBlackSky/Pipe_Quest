<level>
    <listeners>
        <listener initial="true" singleuse="true" id="0">
            <triggers>
                <trigger type="dialogue_reply" arg="0"/>
            </triggers>
            <conditions>
                <condition type="not">
                    <condition id="quest_completed"/>
                </condition>
            </conditions>
            <callbacks>
                <callback type="start_quest">
                    <arg name="quest_id" type="int" val="0"/> 
                </callback>
                <callback type="start_listener">
                    <arg name="listener_id" type="int" val="1"/> 
                </callback>
                <callback type="start_listener">
                    <arg name="listener_id" type="int" val="2"/> 
                </callback>
                <callback type="start_listener">
                    <arg name="listener_id" type="int" val="3"/> 
                </callback>
            </callbacks>
        </listener>

        <listener id="1">
            <triggers>
                <trigger type="collect_item" arg="mushroom"/>
            </triggers>
            <conditions>
                <condition type="less_then">
                    <provider type="items_in_inventory">
                        <arg name="item_id" type="string" value="mushroom"/>
                    </provider>
                    <arg name="value" type="int" value="5"/>
                </condition type="less_then">
            </conditions>
            <callbacks>
                <callback type="set_quest_node">
                    <arg name="quest_id" type="int" val="0"/>
                    <arg name="next_node_id" type="int" val="1"/>
                </callback>
            </callbacks>
        </listener>

        <listener id="2">
            <triggers>
                <trigger type="lost_item" arg="mushroom"/>
            </triggers>
            <conditions>
                <condition type="more_then">
                    <provider type="items_in_inventory">
                        <arg name="item_id" type="string" value="mushroom"/>
                    </provider>
                    <arg name="value" type="int" value="0"/>
                </condition>
            </conditions>
            <callbacks>
                <callback type="set_quest_node">
                    <arg name="quest_id" type="int" val="0"/>
                    <arg name="next_node_id" type="int" val="2"/>
                </callback>
                <callback type="start_listener">
                    <arg name="listener_id" type="int" val="1"/> 
                </callback>
            </callbacks>
        </listener>

        <listener id="3">
            <triggers>
                <trigger type="collect_item" arg="mushroom"/>
            </triggers>
            <conditions>
                <condition type="is_equal_to">
                    <provider type="items_in_inventory">
                        <arg name="item_id" type="string" value="mushroom"/>
                    </provider>
                    <arg name="value" type="int" value="5"/>
                </condition>
            </conditions>
            <callbacks>
                <callback type="set_quest_node">
                    <arg name="quest_id" type="int" val="0"/>
                    <arg name="next_node_id" type="int" val="3"/>
                </callback>
                <callback type="stop_listener">
                    <arg name="listener_id" type="int" val="1"/> 
                </callback>
            </callbacks>
        </listener>

        <listener id="4">
            <triggers>
                <trigger type="dialogue_reply" arg="1"/>
            </triggers>
            <conditions>
                <condition type="is_equal_to">
                    <provider type="items_in_inventory">
                        <arg name="item_id" type="string" value="mushroom"/>
                    </provider>
                    <arg name="value" type="int" value="5"/>
                </condition>
            </conditions>
            <callbacks>
                <callback type="set_quest_node">
                    <arg name="quest_id" type="int" val="0"/>
                    <arg name="next_node_id" type="int" val="4"/>
                </callback>
                <callback type="stop_listener">
                    <arg name="listener_id" type="int" val="2"/> 
                </callback>
                <callback type="stop_listener">
                    <arg name="listener_id" type="int" val="3"/> 
                </callback>
                <callback type="stop_listener">
                    <arg name="listener_id" type="int" val="4"/> 
                </callback>
            </callbacks>

        </listener>
    </listeners>
</level>